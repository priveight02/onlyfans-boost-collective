# Stripe Integration Backup
> Saved on 2026-02-16 — Full reference of all Stripe IDs, price maps, and integration logic.
> **REBUILT FROM SCRATCH (v2)** — All previous products deleted, fresh products created with descriptions.

## Credit Packages (One-Time)
| Package | Credits | Bonus | Price | Product ID | Price ID |
|---------|---------|-------|-------|------------|----------|
| Starter Credits | 350 | 0 | $9.00 | prod_TzUvjEQxMm91SA | price_1T1VvhAMkMnyWeZ5lIv4ilgw |
| Pro Credits | 1,650 | 350 | $29.00 | prod_TzUvJdy1Ud9CwK | price_1T1Vw2AMkMnyWeZ5SCCwTDHW |
| Studio Credits | 3,300 | 550 | $49.00 | prod_TzUwxv5QZxf5Su | price_1T1VwFAMkMnyWeZ5DZP4IpLR |
| Power User Credits | 8,250 | 1,100 | $149.00 | prod_TzUw5rmGT2yb6k | price_1T1VwjAMkMnyWeZ5ZHBspozW |

## Credit Package Discount Variants
| Package | Discount | Price | Product ID | Price ID | Coupon |
|---------|----------|-------|------------|----------|--------|
| Starter | 10% | $8.10 | prod_TzUwkDqytjJPVw | price_1T1VwzAMkMnyWeZ5MaANn3V2 | j5jMOrlU |
| Starter | 20% | $7.20 | prod_TzUxvrfY0EPJ5P | price_1T1VxXAMkMnyWeZ5pDsbaXcg | r71MZDc7 |
| Starter | 30% | $6.30 | prod_TzUxhJWvFbiM9Q | price_1T1VxyAMkMnyWeZ5AMHGbRCP | DsXHlXrd |
| Starter | 50% | $4.50 | prod_TzUy6zU1TfP1Nx | price_1T1VyNAMkMnyWeZ5FNjvbsFT | 5P34jI5L |
| Pro | 10% | $26.10 | prod_TzUyxIFDAinGeC | price_1T1VygAMkMnyWeZ5qC7pWy2G | j5jMOrlU |
| Pro | 20% | $23.20 | prod_TzUy0puCS3I21q | price_1T1VyxAMkMnyWeZ52iLSjFNj | r71MZDc7 |
| Pro | 30% | $20.30 | prod_TzUzcmhs9IkIwY | price_1T1VzSAMkMnyWeZ5Q4tgbIrb | DsXHlXrd |
| Pro | 50% | $14.50 | prod_TzV0YT93wKvuwL | price_1T1W00AMkMnyWeZ57LGFwE3u | 5P34jI5L |
| Studio | 10% | $44.10 | prod_TzV0IC3yOtDgwD | price_1T1W0RAMkMnyWeZ5uQP5ICZ3 | j5jMOrlU |
| Studio | 20% | $39.20 | prod_TzV0moO0gDf3P5 | price_1T1W0jAMkMnyWeZ5tBjnhmNB | r71MZDc7 |
| Studio | 30% | $34.30 | prod_TzV0zCujQUkjXP | price_1T1W0vAMkMnyWeZ5R2r5caT8 | DsXHlXrd |
| Studio | 50% | $24.50 | prod_TzV1ZYD6KIOFqs | price_1T1W1GAMkMnyWeZ5LN8vXukX | 5P34jI5L |
| Power User | 10% | $134.10 | prod_TzV1EWzlImLDYE | price_1T1W1VAMkMnyWeZ5P4MDJLcw | j5jMOrlU |
| Power User | 20% | $119.20 | prod_TzV1JMyA8d5EB6 | price_1T1W1nAMkMnyWeZ5B5MceXoT | r71MZDc7 |
| Power User | 30% | $104.30 | prod_TzV21bvQ4sCJvL | price_1T1W21AMkMnyWeZ5JgOWPv72 | DsXHlXrd |
| Power User | 50% | $74.50 | prod_TzV2bYBxcXuEey | price_1T1W2KAMkMnyWeZ5JmXldM8x | 5P34jI5L |

## Subscription Plans
| Plan | Cycle | Price | Product ID | Price ID | Coupon |
|------|-------|-------|------------|----------|--------|
| Starter | Monthly | $9/mo | prod_TzUtPv1PXmYddy | price_1T1VtcAMkMnyWeZ53qnVqlx2 | — |
| Starter | Yearly | $108/yr → $91.80 | prod_TzUtpBDWyb3qR6 | price_1T1Vu0AMkMnyWeZ57TMdUk5H | tY7Dc8CS (15%) |
| Pro | Monthly | $29/mo | prod_TzUuDHxcoyItCj | price_1T1VuFAMkMnyWeZ5oAMJzq3T | — |
| Pro | Yearly | $348/yr → $243.60 | prod_TzUuv2bXrA1EVF | price_1T1VucAMkMnyWeZ50DDf2j2h | Tw4fW0YB (30%) |
| Business | Monthly | $79/mo | prod_TzUu26T8Hiv2lS | price_1T1VupAMkMnyWeZ5hyccueXN | — |
| Business | Yearly | $948/yr → $635.16 | prod_TzUv67N4QUbXHN | price_1T1VvOAMkMnyWeZ5zzNrQuDg | OC7IWjQT (33%) |

## Stripe Coupons
| Coupon | ID | Discount | Duration | Use |
|--------|----|----------|----------|-----|
| Loyalty 10% Off | j5jMOrlU | 10% | once | Credit packages (3rd repurchase) |
| Loyalty 20% Off | r71MZDc7 | 20% | once | Credit packages (2nd repurchase) |
| Loyalty 30% Off | DsXHlXrd | 30% | once | Credit packages (1st repurchase) |
| Retention 50% Off | 5P34jI5L | 50% | once | Credit packages (one-time retention) |
| Yearly Starter 15% | tY7Dc8CS | 15% | forever | Starter yearly subscription |
| Yearly Pro 30% | Tw4fW0YB | 30% | forever | Pro yearly subscription |
| Yearly Business 33% | OC7IWjQT | 33% | forever | Business yearly subscription |

## Plan Credits
| Plan | Credits/Month |
|------|--------------|
| Starter | 215 |
| Pro | 1,075 |
| Business | 4,300 |

## Product Images (Hosted in product-images bucket)
| Product | Image File |
|---------|-----------|
| Starter Credits | credits-starter.png |
| Pro Credits | img-pro-base.png |
| Studio Credits | img-studio-base.png |
| Power User Credits | img-power-base.png |
| Starter Plan | plan-starter-coins.png |
| Pro Plan | plan-pro-coins-fixed.png |
| Business Plan | plan-business-coins.png |
| Custom Credits | credits-custom.png |

## Discount Strategy
- **Loyalty discounts** (10%/20%/30%): Applied via Stripe coupons at checkout on base price
- **Retention discount** (50%): One-time offer for eligible Pro/Business users
- **Volume discounts**: Applied in purchase-credits edge function for custom credits (5-40%)
- **Yearly discounts**: Applied via Stripe coupons (15%/30%/33%) at checkout
- **Coupons are NOT stacked** — retention overrides loyalty

## Pricing Logic
- **Volume discounts** (custom credits): 5% (10k+), 15% (15k+), 20% (20k+), 25% (30k+), 30% (50k+), 35% (75k+), 40% (100k+)
- **Loyalty discounts**: 30% (1st repurchase), 20% (2nd), 10% (3rd), 0% after
- **Retention discount**: 50% one-time offer for eligible Pro/Business users
- **Custom credits**: Min 500, volume + loyalty discounts stack

## Edge Functions
1. `purchase-credits` — Creates Stripe checkout for credit packages or custom credits
2. `create-checkout` — Creates Stripe checkout for subscriptions (handles upgrade/downgrade)
3. `customer-portal` — Opens Stripe billing portal
4. `billing-info` — Fetches subscription, payments, retention eligibility
5. `verify-credit-purchase` — Verifies Stripe sessions and credits wallet (idempotent)
6. `check-wallet` — Returns wallet balance (ensures wallet exists)

## Eligible Retention Product IDs
Pro + Business: prod_TzUuDHxcoyItCj, prod_TzUuv2bXrA1EVF, prod_TzUu26T8Hiv2lS, prod_TzUv67N4QUbXHN

## Checkout Success URLs
- Credits: `https://ozcagency.com/pricing?success=true&credits={N}`
- Subscriptions: `https://ozcagency.com/profile?subscription=success&plan={planId}`
